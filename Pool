import java.util.*;


public class Pool {
	
	private ArrayList<Meld> pool;
	
	public Pool()
	{
		pool = new ArrayList<Meld>();
	}
	
	public int score(Card[] playedCards)
	{
		/* Scoring Algorithm:
		 * 
		 * Loop through pool, until can successfully add playedCards to an already played sequence or set. If successfully added, stop looping
		 * and return valueCards(playedCards).
		 * If cannot add, check if play is valid on its own. If valid, add to pool and return
		 * valueCards(playedCards).
		 * If can't add and not valid by itself, return -1.
		 * 
		 */
		boolean isLegal = false;;
		
		for(int i=0; i<pool.size() && !isLegal; i++)// loop through pool and try to append to existing melds, stop if successful append
		{
			isLegal = pool.get(i).append(playedCards);// update isLegal with success/failure of each append
		}
		
		if(isLegal)// if cards were legally played, return score
		{
			return valueCards(playedCards);
		}
		
		// cards cannot be appended to existing meld, can they be played by themselves?
		
		if(playedCards.length<3)// cannot form a legal meld with less than 3 cards, illegal play, return -1
		{
			return -1;
		}
		
		Card[] remainingCards = Arrays.copyOfRange(playedCards, 1, playedCards.length); // put all but first card of playedCards into a new array
		
		// try playing cards as a sequence
		Sequence seq = new Sequence(playedCards[0]);
		if(seq.append(remainingCards)) // if cards can be legally played as a sequence, add the new sequence to pool and return score
		{
			pool.add(seq);
			return valueCards(playedCards);
		}
		
		// try playing cards as a set
		Set set = new Set(playedCards[0]);
		if(set.append(remainingCards)) // if cards can be legally played as a set, add the new set to pool and return score
		{
			pool.add(set);
			return valueCards(playedCards);
		}
		
		// cards cannot be played on an existing meld and are not legal on their own, illegal play, return -1		
		return -1;
	}
	
	private int valueCards(Card[] cards)
	{
		int value = 0;
		for(int i=0; i<cards.length; i++)
		{
			value += cards[i].getValue();
		}
		return value;
	}
	
	@Override
	public String toString() 
	{
		String result = "";
		
		for(int i=0;i<pool.size();i++)
		{
			result+= pool.get(i).getCards() + "\n";
		}
		
		return result;
	}
	
	private interface Meld
	{
		
		/* append(Cards[] cards) attempts to add cards to hand
		 * updates hand and returns true if legal
		 * does not update hand and returns false if illegal 
		 */
		public boolean append(Card[] cards);
		
		// getCards() returns the cards in this meld in an ArrayList of Cards
		public ArrayList<Card> getCards();
	}
	private class Sequence implements Meld
	{
		private ArrayList<Integer> values;
		private String suit;
		
		public Sequence(Card card) // Sequence constructor: all sequences start out as 1 card, more can then be appended
		{
			values = new ArrayList<Integer>();
			values.add(card.getValue());
			suit = card.getSuit();
		}
		
		public boolean append(Card[] cards)
		{
				for(int i=0; i<cards.length; i++) // loop through cards to determine if they have the correct suit
				{
					if(!suit.equals(cards[i].getSuit())) // if suit does not match, failed to append
							return false;
				}
				
				ArrayList<Integer> temp = new ArrayList<Integer>(); // create temporary ArrayList containing all values
				temp.addAll(values);
				for(int i=0; i<cards.length; i++)
				{
					temp.add(cards[i].getValue());
				}
				
				Collections.sort(temp); // sort temp
				
				for(int i=0; i<temp.size()-1; i++) // if values of temp are not consecutive, failed to append
				{
					if(temp.get(i+1)-temp.get(i)!=1)
						return false;
				}
				
				values = temp; // everything has same suit and is consecutive, set values equal to temp
			
				return true; // successful append
		}
		
		public ArrayList<Card> getCards()
		{
			ArrayList<Card> cards = new ArrayList<Card>();
			for(int i=0;i<values.size();i++)
			{
				cards.add(new Card(values.get(i),suit));
			}
			return cards;
		}
	}
	
	private class Set implements Meld
	{
		private int value;
		private ArrayList<String> suits;
		
		public boolean append(Card[] cards)
		{
			for(int i=0; i<cards.length; i++) // loop through cards to determine if they have the correct value
			{
				if(value != (cards[i].getValue())) // if value does not match, failed to append
						return false;
			}
			
			for(int i=0; i<cards.length; i++) // values are the same, add new suits
			{
				suits.add(cards[i].getSuit());
			}
			
			return true; // successful append
		}
		
		public ArrayList<Card> getCards()
		{
			ArrayList<Card> cards = new ArrayList<Card>();
			for(int i=0;i<suits.size();i++)
			{
				cards.add(new Card(value,suits.get(i)));
			}
			return cards;
		}
		
		public Set(Card card) // Set constructor: all sets start out as 1 card, more can then be appended
		{
			suits = new ArrayList<String>();
			suits.add(card.getSuit());
			value = card.getValue();
		}
	}	
}
	




public class Card {
	
	private int value;
	private String suit;
	
	public Card(int value, String suit) 
	{		
		this.value = value;
		this.suit = suit;
	}

	public int getValue() {
		return value;
	}

	public String getSuit() {
		return suit;
	}

	@Override
	public String toString() {
		if(suit.equals("heart"))
			return "["+value+"H]";
		else if(suit.equals("diamond"))
			return "["+value+"D]";
		else if(suit.equals("spade"))
			return "["+value+"S]";
		else 
			return "["+value+"C]";
	}
	
}




import java.util.*;

public class Tester {

	public static void main(String[] args)
	{
		Pool p = new Pool();
		
		System.out.println("Empty pool: " + p);
		
		Card[] c1 = new Card[]{new Card(2,"heart"), new Card(3,"heart"), new Card(4,"heart")};
		System.out.println("\nc1: "+Arrays.toString(c1));
		System.out.println("Playing c1: " + p.score(c1));
		System.out.println("p:\n" + p);
		
		Card[] c2 = new Card[]{new Card(5,"heart"), new Card(1,"heart")};
		System.out.println("\nc2: "+Arrays.toString(c2));
		System.out.println("Playing c2: " + p.score(c2));
		System.out.println("p:\n" + p);
		
		Card[] c3 = new Card[]{new Card(6,"heart"), new Card(7,"heart")};
		System.out.println("\nc3: "+Arrays.toString(c3));
		System.out.println("Playing c3: " + p.score(c3));
		System.out.println("p:\n" + p);
		
		Card[] c4 = new Card[]{new Card(8,"heart"), new Card(10,"heart")};
		System.out.println("\nc4: "+Arrays.toString(c4));
		System.out.println("Playing c4: " + p.score(c4));
		System.out.println("p:\n" + p);
		
		Card[] c5 = new Card[]{new Card(8,"spade"), new Card(9,"heart")};
		System.out.println("\nc5: "+Arrays.toString(c5));
		System.out.println("Playing c5: " + p.score(c5));
		System.out.println("p:\n" + p);
		
		Card[] c6 = new Card[]{new Card(2,"spade"), new Card(3,"spade"), new Card(4,"spade")};
		System.out.println("\nc6: "+Arrays.toString(c6));
		System.out.println("Playing c6: " + p.score(c6));
		System.out.println("p:\n" + p);
		
		Card[] c7 = new Card[]{new Card(2,"club"), new Card(3,"club"), new Card(5,"club")};
		System.out.println("\nc7: "+Arrays.toString(c7));
		System.out.println("Playing c7: " + p.score(c7));
		System.out.println("p:\n" + p);
		
		Card[] c8 = new Card[]{new Card(7,"heart"), new Card(7,"diamond"), new Card(7,"spade")};
		System.out.println("\nc8: "+Arrays.toString(c8));
		System.out.println("Playing c8: " + p.score(c8));
		System.out.println("p:\n" + p);
		
		Card[] c9 = new Card[]{new Card(8,"club")};
		System.out.println("\nc9: "+Arrays.toString(c9));
		System.out.println("Playing c9: " + p.score(c9));
		System.out.println("p:\n" + p);
		
		Card[] c10 = new Card[]{new Card(7,"club")};
		System.out.println("\nc10: "+Arrays.toString(c10));
		System.out.println("Playing c10: " + p.score(c10));
		System.out.println("p:\n" + p);
	}
	
}
